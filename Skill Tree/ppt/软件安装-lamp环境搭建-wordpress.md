## Linux安装软件-搭建lamp环境

### 实验目的

* 掌握linux如何让去安装软件，搭建出自己的博客系统


## linux安全检查
> **linux系统安全**
> 它是一种位于内部网络与外部网络之间的网络安全系统。一项信息安全的防护系统，依照特定的规则，允许或是限制传输的数据通过。被用来保护我们的系统。现在的防火墙是通过规则来控制数据的，又叫防火墙策略。防火墙策略一般分为两种，一种叫“通”策略，一种叫“堵”策略，通策略，默认门是关着的，必须要定义谁能进。堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进。

> iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。
	
>	我们可以使用service来控制它。
>	service iptables start/stop/restart
	
> filter 功能是防火墙一个重要的功能，它定义允许或者不允许的    INPUT、FORWARD、OUTPUT

* > 形象的介绍防火强
    防火墙就像是窗户和门，保护我们的房屋，为了安全，不允许人们通过窗户进入房屋，就像系统中一些端口，21的ftp端口，如果任意的人都可以访问，就是系统很大的安全隐患，因此需要使用防火墙给包起来，这就是堵。
    而与门，只要你有身份认证，都可以进入，就像百度，使用80端口放入web服务，每个人都可以访问，这就是通。
    新版的linux系统中，它作为服务运行
    可以通过service控制


> 本实验通过讲解iptables的配置，sshd的配置方法以及避免弱口令三个方面来提高linux系统的安全性。


**注** 学习本实验前需要对Linux防火墙有一定的基础了解。


>:INPUT ACCEPT [0:0]
>:FORWARD ACCEPT [0:0]
>:OUTPUT ACCEPT [0:0]
>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
>-A INPUT -p icmp -j ACCEPT
>-A INPUT -i lo -j ACCEPT
>-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
>-A INPUT -j REJECT --reject-with icmp-host-prohibited
>-A FORWARD -j REJECT --reject-with icmp-host-prohibited

```
iptables命令参数：

        -A 追加
        -j 指定如何进行处理 DROP，REJECT，ACCEPT，丢弃，拒绝，通过
        -p 指定协议类型
            三种tcp、udp、icmp
            tcp通过dport指定目标端口，sport指定源端口
            udp一样。
            icmp通过--icmp-type指定类型，0是响应类型的数据包，8是请求类型的包。
        -m 表示启用扩展功能
            一般和-p配合，-p指定类型后，通过-m打开此类型的扩展功能。
        
查看管理命令 “-L”
	附加子命令
	-n：以数字的方式显示ip，它会将ip直接显示出来，如果不加-n，则会将ip反向解析成主机名。
	-v：显示详细信息

轻微讲解 udp、tcp、icmp
```
* > 根据一条防火墙策略来讲解命令


#### 步骤1：配置iptables避免ip扫描

首先需要打开linux主机防火墙。

> 使用命令：
>
> ```
> service iptables start 		//开启防火墙
> ```

![1][1]

编辑iptables的配置文件

>vim /etc/sysconfig/iptables
>
>```
># Generated by iptables-save v1.4.7 on Wed May 24 22:05:18 2017
>*filter
>##############################################################
>:INPUT ACCEPT [0:0]
>:FORWARD ACCEPT [0:0]
>:OUTPUT ACCEPT [0:0]
>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
>-A INPUT -p icmp -j ACCEPT
>-A INPUT -i lo -j ACCEPT
>-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
>-A INPUT -j REJECT --reject-with icmp-host-prohibited
>-A FORWARD -j REJECT --reject-with icmp-host-prohibited
>##############################################################
>COMMIT
># Completed on Wed May 24 22:05:18 2017
>
>删除#####之间的内容，如果你的内容与上面不一样，也无所谓，直接删除即可，改为
>
># Generated by iptables-save v1.4.7 on Wed May 24 22:05:18 2017
>*filter
>##############################################################
>:INPUT DROP [0:0]
>:FORWARD DROP [0:0]
>:OUTPUT DROP [0:0]
>-A INPUT -p udp -m udp --sport 53 -j ACCEPT
>-A INPUT -p udp -m udp --dport 53 -j ACCEPT
>-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
>-A INPUT -p tcp -m tcp --dport 5022 -j ACCEPT
>-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
>-A INPUT -p icmp -m icmp --icmp-type 8 -j DROP
>-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT
>-A OUTPUT -p udp -m udp --sport 53 -j ACCEPT
>-A OUTPUT -p udp -m udp --dport 53 -j ACCEPT
>-A OUTPUT -p tcp -m tcp --sport 22 -j ACCEPT
>-A OUTPUT -p tcp -m tcp --sport 5022 -j ACCEPT
>-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
>-A OUTPUT -p tcp -m tcp --dport 80 -m state --state NEW -j ACCEPT
>-A OUTPUT -s 192.168.6.199/32 -p icmp -m icmp --icmp-type 0 -j DROP
>-A OUTPUT -s 192.168.6.199/32 -p icmp -m icmp --icmp-type 8 -j ACCEPT
>##############################################################
>COMMIT
># Completed on Wed May 24 22:05:18 2017
>
>注：下面我们会详细讲解每一条含义
>```

 测试主机现况

>ping  ip地址  -t
>
>```
>ping 192.168.6.199 -t
>```

![2][2]

`注：此时我们是可以ping通linux主机`

重启防火墙服务

> service iptables restart

![3][3]

`注：我们会发现linux无法pingtong`

linux主机向外发ping包

![4][4]

`此时可以发现，linux主机可以ping通外网`

查看iptables列表

> iptables  -nvL
>
> ```
> Chain INPUT (policy DROP 445 packets, 97130 bytes)
>  pkts bytes target     prot opt in     out     source               destination         
>     0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0           udp spt:53   ##DNS入站
>     0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0           udp dpt:53   ##DNS入站
>     5   440 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:22  ##sshd入站
>    23  2056 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:5022 ##sshd入站（为下面实验预留）
>    29  2436 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED  ##以建立连接入站
>     8   480 DROP       icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 8 ##ping命令
>     0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 0 ##ping命令
>
> Chain FORWARD (policy DROP 0 packets, 0 bytes)
>  pkts bytes target     prot opt in     out     source               destination         
>
> Chain OUTPUT (policy DROP 0 packets, 0 bytes)
>  pkts bytes target     prot opt in     out     source               destination         
>     0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0           udp spt:53  ##DNS出站
>     0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0           udp dpt:53  ##DNS出站
>     5   200 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp spt:22 ##sshd出站
>    18  1168 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp spt:5022  ##sshd出站（为下面实验预留）
>    28  2352 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED  ##以建立连接出站
>     0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:80 state NEW  ##yum命令入站
>     0     0 DROP       icmp --  *      *       192.168.6.199        0.0.0.0/0           icmp type 0  ##ping命令
>     1    84 ACCEPT     icmp --  *      *       192.168.6.199        0.0.0.0/0           icmp type 8  ##ping命令
> ```

#### 步骤2：配置sshd避免端口扫描

`本步骤将配置sshd服务，来改变监听端口和拒绝root用户远程登录`
首先我们可以通过shell，putty等工具使用默认22端口进行root远程登录

![5][5]

接下来我们配置一下sshd服务的配置文件

> vim /etc/ssh/sshd_config 
>
>```
>找到如下两个选项
>#Port 22
>  ...
>#PermitRootLogin yes
>  ...
> 改为
>Port 5022      ###此处的5022端口就是在防火墙上预留的端口，如果改变端口，连同防火墙预留端口一起更改
>  ...
>PermitRootLogin no  ### 禁止root用户通过ssh登登录
>  ...
>```

重启sshd服务

> service sshd restart

我们先用默认22端口连接

![6][6]

直接返回连接失败

我们再用root账号，5022端口连接

![7][7]

在输入密码后，直接提示“ssh服务器拒绝了密码”

我们使用test111账号，5022端口连接

![8][8]

成功连接，至此我们就可以避免22端口的扫描和root远程连接

#### 步骤3：创建无法登陆用户及避免弱口令

`本步骤将创建无法登陆账户及避免弱口令`
>useradd  -s /bin/nologin   用户名
>
>```
>我们在创建用户时候指定参数-s /bin/nologin,这样创建的用户可以有应用权限，但是不可以登陆
>```

![9][9]

> passwd命令避免弱口令
>
> ```
> 当我们在给一个用户设置密码时，如果系统提示密码无效。如下图，则说明设置的密码属于弱口令，是容易被黑客扫描出来。当设置一个真正复杂密码时候则不会有这样提示，下面则是复杂密码的设置显示
> ```

![10][10]

## 安装软件

### **yum 安装**

* > 这个 yum 是通过分析 RPM 的标头数据后， 根据各软件的相关性制作出属性相依时的解决方案，然后可以自动处理软件的相依属性问题，以解决软件安装或移除与升级的问题。 
* > yum是很方便的，它直接在云端下载软件，根据每个不同版本的系统获取不同的软件信息，按顺序下载rpm包，安装软件。

#### **yum参数介绍**

    搜索软件:
        [root@study ~]# yum search ：搜寻某个软件名称或者是描述 （description） 的重要关键字；
    安装软件：
        [root@study ~]# yum install ：后面接要安装的软件！
    卸载软件：
        [root@study ~]# yum uninstall ：后面接要安装的软件！


    尝试使用yum安装指定版本的软件。
    先搜索，再安装，删除

### **rpm安装**
* > RPM 类型的文件在安装的时候，会先去读取文件内记载的设置参数内容，然后将该数据用来比对 Linux 系统的环境，以找出是否有属性相依的软件尚未安装的问题。
* > RPM 使用自动化安装软件，比较类似windows下的.exe需要下载安装包，但是它安装过程中会有很多的依赖问题。

#### **rpm参数介绍**

rpm安装软件
```
[root@study ~]# rpm -ivh package_name
选项与参数：
-i ：install 的意思
-v ：察看更细部的安装信息画面
-h ：以安装信息列显示安装进度
```

rpm查询软件信息
```
查询已安装软件的信息：
-q  ：仅查询，后面接的软件名称是否有安装；
-qa ：列出所有的，已经安装在本机 Linux 系统上面的所有软件名称；
-ql ：列出该软件所有的文件与目录所在完整文件名 （list）；
-qR ：列出与该软件有关的相依软件所含的文件 （Required 的意思）
```

* 准备一套安装gcc的rpm包。

    rpm -Uvh kernel-headers-2.6.32-431.el6.x86_64.rpm
    rpm -Uvh glibc-headers-2.12-1.132.el6.x86_64.rpm
    rpm -Uvh glibc-devel-2.12-1.132.el6.x86_64.rpm
    rpm -Uvh libgomp-4.4.7-4.el6.x86_64.rpm
    rpm -Uvh ppl-0.10.2-11.el6.x86_64.rpm
    rpm -Uvh cloog-ppl-0.15.7-1.2.el6.x86_64.rpm
    rpm -Uvh mpfr-2.4.1-6.el6.x86_64.rpm
    rpm -Uvh cpp-4.4.7-4.el6.x86_64.rpm
    rpm -Uvh gcc-4.4.7-4.el6.x86_64.rpm

    按照顺序安装

    再安装前使用快照



### **源码安装**
* > 之前介绍了常见的二进制包，比如rpm和deb，软件开发者必须为每种特定的平台定制好专门的软件包。
* > 在linux下的很多软件都是通过源码包方式发布的，虽然相对于二进制软件包，配置和编译起来繁琐点，但是它的可移植性却好得多，针对不同的体系结构，软件开发者往往仅需发布同一份源码包，不同的最终用户经过编译就可以正确运行，这也是非常符合c语言的设计哲学的,一次编写，到处编译。

#### **gcc make**

* > GNU编译器套件（GNU Compiler Collection）包括C、C++、Objective-C、Fortran、Java、Ada和Go语言的前端，也包括了这些语言的库（如libstdc++、libgcj等等）。GCC的初衷是为GNU操作系统专门编写的一款编译器。
* > make是一个方便人们编译源码的快捷软件，它会自动的根据makefile文件编译所有的源码文件，生成一个可执行文件。

#### **源码编译流程**

* 开始configure前还是应该仔细阅读源码目录下的README或者INSTALL文件,好多安装中的注意事项在这里都有所罗列,

* ./configure:
    解压完成就正式开始安装了,首先跳转到源码的解压目录，configure实际上是一个脚本文件，在当前目录中键入"./configure",shell就会运行当前目录下的configure脚本.
    在整个configure过程，其实编译尚未进行，configure仅仅是做编译相关的准备工作，它主要对您当前的工作平台做一些依赖性检查，比如编译器是否安装，连接器是否存在.

* ./make
    如果configure过程正确完成，那么在源码目录，会生成相应的Makefile文件，Makefile文件简单来说包括的是一组文件依赖关系以及编译链接的相关步骤，事实上真正的编译链接工作也不是make所做的，make只是一个通用的工具，一般情况下，make会根据Makefile中的规则调用合适的编译器编译所有与当前软件相依赖的源码，生成所有相关的目标文件，最后再使用链接器生成最终的可执行程序: 

* make install:
    当上面两个步骤正确完成，代表着编译链接过程已经完全结束，最后要做的就是将可执行程序安装到正确的位置，在这个步骤，普通用户可能没有相关目录的操作权限，最好临时切换到root。如果在configure阶段没有使用"--prefix=/opt/XXX"指定应用程序的安装目录，那么应用程序一般会被默认安装到/usr/local/bin。

* make clean和make uninstall
    clean是根据makefile来清理临时文件
    uninstall是根据makefile来删除安装后的程序，需要root用户

* 使用源码安装软件
    apache
    过程中会遇到很多的依赖问题
    使用yum来安装依赖

## 搭建lamp环境

* Linux 是免费开源软件，这意味着源代码可用的操作系统。

* Apache 是使用中最受欢迎的一个开放源码的WEB服务器软件。

* MySQL 是多线程、多用户的SQL数据库管理系统。

* PHP 是一种编程语言最初设计生产动态网站。PHP 是主要用于服务器端的应用程序软件。

* 为什么安装lamp环境
    LAMP（Linux- Apache-MySQL-PHP）网站架构是目前国际流行的Web框架，该框架包括：Linux操作系统，Apache网络服务器，MySQL数据 库，PHP编程语言，所有组成产品均是开源软件，是国际上成熟的架构框架，很多流行的商业应用都是采取这个架构。
    只是因为它免费，简单好学，安全性好。

### **使用yum安装lamp**

* 首先更新一下系统
    yum -y update

* > apache 
    yum install httpd httpd-devel httpd-manual mod_ssl mod_perl mod_auth_mysql
    安装完成后：
        service httpd start 启动apache 
    设为开机启动:
        chkconfig httpd on


* > mysql

    yum install mysql mysql-server mysql-devel 
    完成后： 
    service mysqld start 启动mysql

    配置mysql

    使用mysql_secure_installation命令初始化mysql数据库

    设为开机启动 
        chkconfig mysqld on

* > php

    yum install php php-mysql php-common php-gd php-mbstring php-mcrypt php-devel php-xml

* 在/var/www/html/新建个index.php文件，将以下内容写入，然后保存。

```php
<? 
phpinfo(); 
?> 
```


## 搭建wordpress博客

* 关闭系统中的selinux
    selinux 是新版的linux系统自带的安全管理软件，但是它经常影响我们的网站运营，同事它并不能增强我们系统的安全
```
vi /etc/selinux/config  
    
#SELINUX=enforcing #注释掉  
    
#SELINUXTYPE=targeted #注释掉  
    
SELINUX=disabled #增加  
    
:wq! #保存退出  
```


* [Wordpress地址](https://cn.wordpress.org/)

* > 把下载的wordpress的文件解压，放入到apache的目录下，用浏览器打开，开始安装

## **实验**

### **实验环境**

centos6.5

### **要求**

* > 实验一：	
	把今天讲的内容总结，写成博客，发布到wordpress系统中。
* > 实验二：
	配置防火墙，只能访问web服务和ssh。

### **目的**

练习今天的课程，同事可以养成一个写总结的好习惯




[1]:./image/1.jpg
[2]:./image/2.jpg
[3]:./image/3.jpg
[4]:./image/4.jpg
[5]:./image/5.jpg
[6]:./image/6.jpg
[7]:./image/7.jpg
[8]:./image/8.jpg
[9]:./image/9.jpg
[10]:./image/10.gif
